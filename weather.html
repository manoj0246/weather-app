<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 4: Weather App (Corporate Redesign)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* gray-100 */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="md:flex">
            <!-- Left Side: Current Weather -->
            <div class="md:w-1/2 p-8 bg-slate-800 text-white">
                <div id="current-weather-content">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 id="city-name" class="text-3xl font-bold"></h2>
                            <p id="current-date" class="text-slate-400"></p>
                        </div>
                        <div class="flex items-center gap-2 text-sm">
                            <span>Â°C</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="unit-toggle" class="sr-only peer">
                                <div class="w-11 h-6 bg-slate-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                            <span>Â°F</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-center my-12">
                        <div id="weather-icon-main" class="text-8xl"></div>
                        <p id="temperature" class="text-8xl font-bold ml-6"></p>
                    </div>
                    <p id="weather-description" class="text-2xl capitalize text-center font-semibold"></p>
                </div>
            </div>

            <!-- Right Side: Search & Forecast -->
            <div class="md:w-1/2 p-8">
                <!-- Search Form -->
                <form id="search-form" class="flex gap-2 mb-6">
                    <input type="text" id="city-input" placeholder="Search for a city..." class="flex-grow p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
                    <button type="submit" class="bg-slate-800 text-white font-semibold p-3 rounded-lg hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-offset-2 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                    </button>
                </form>

                <!-- Details & Forecast -->
                <div id="details-and-forecast">
                    <div class="grid grid-cols-3 gap-4 text-center border-b pb-4 mb-4">
                        <div>
                            <p class="text-sm text-slate-500">Feels Like</p>
                            <p class="font-bold text-slate-700 text-lg" id="feels-like"></p>
                        </div>
                        <div>
                            <p class="text-sm text-slate-500">Humidity</p>
                            <p class="font-bold text-slate-700 text-lg" id="humidity"></p>
                        </div>
                        <div>
                            <p class="text-sm text-slate-500">Wind</p>
                            <p class="font-bold text-slate-700 text-lg" id="wind-speed"></p>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mb-2">5-Day Forecast</h3>
                    <div id="forecast-grid" class="space-y-2"></div>
                </div>
                
                <!-- Message Center -->
                <div id="message-center" class="text-center py-16 hidden">
                    <div id="loader" class="hidden">
                        <svg class="animate-spin h-8 w-8 text-slate-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    </div>
                    <div id="error-message" class="hidden">
                        <h2 class="text-xl font-semibold text-red-500"></h2>
                        <p class="text-slate-500 mt-1"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const apiKey = 'a36c8ce59c34cd59abf38f6e0b0d517d';
            let currentUnit = 'metric';
            let lastCity = 'Delhi';

            const searchForm = document.getElementById('search-form');
            const cityInput = document.getElementById('city-input');
            const unitToggle = document.getElementById('unit-toggle');

            const messageCenter = document.getElementById('message-center');
            const loader = document.getElementById('loader');
            const errorMessage = document.getElementById('error-message');
            const currentWeatherContent = document.getElementById('current-weather-content');
            const detailsAndForecast = document.getElementById('details-and-forecast');

            function getWeatherIconEmoji(weatherMain) {
                const iconMap = {
                    'Clear': 'â˜€ï¸', 'Clouds': 'â˜ï¸', 'Rain': 'ðŸŒ§ï¸', 'Drizzle': 'ðŸŒ¦ï¸',
                    'Thunderstorm': 'â›ˆï¸', 'Snow': 'â„ï¸', 'Mist': 'ðŸŒ«ï¸', 'Smoke': 'ðŸŒ«ï¸',
                    'Haze': 'ðŸŒ«ï¸', 'Dust': 'ðŸŒ«ï¸', 'Fog': 'ðŸŒ«ï¸',
                };
                return iconMap[weatherMain] || 'ðŸŒ';
            }

            function displayMessage(type, title, text) {
                currentWeatherContent.classList.add('hidden');
                detailsAndForecast.classList.add('hidden');
                messageCenter.classList.remove('hidden');
                if (type === 'loading') {
                    loader.classList.remove('hidden');
                    errorMessage.classList.add('hidden');
                } else {
                    loader.classList.add('hidden');
                    errorMessage.classList.remove('hidden');
                    errorMessage.querySelector('h2').textContent = title;
                    errorMessage.querySelector('p').textContent = text;
                }
            }

            async function fetchWeatherData(city) {
                lastCity = city;
                displayMessage('loading');

                const weatherUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=${currentUnit}`;
                const forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=${currentUnit}`;

                try {
                    const [weatherResponse, forecastResponse] = await Promise.all([
                        fetch(weatherUrl),
                        fetch(forecastUrl)
                    ]);
                    if (!weatherResponse.ok || !forecastResponse.ok) {
                        const error = new Error('API request failed');
                        error.status = weatherResponse.status;
                        throw error;
                    }
                    const weatherData = await weatherResponse.json();
                    const forecastData = await forecastResponse.json();
                    updateUI(weatherData, forecastData);
                } catch (error) {
                    console.error("Weather data error:", error);
                    if (error.status === 401) displayMessage('error', 'Invalid API Key', 'Please check your API key.');
                    else if (error.status === 404) displayMessage('error', 'City Not Found', 'Please check the spelling.');
                    else displayMessage('error', 'Request Failed', 'Could not retrieve weather data.');
                }
            }

            function updateUI(weather, forecast) {
                messageCenter.classList.add('hidden');
                currentWeatherContent.classList.remove('hidden');
                detailsAndForecast.classList.remove('hidden');

                const tempUnit = currentUnit === 'metric' ? 'Â°C' : 'Â°F';
                const windUnit = currentUnit === 'metric' ? 'km/h' : 'mph';

                // Current weather
                document.getElementById('city-name').textContent = weather.name;
                document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
                document.getElementById('temperature').textContent = `${Math.round(weather.main.temp)}${tempUnit}`;
                document.getElementById('weather-description').textContent = weather.weather[0].description;
                document.getElementById('weather-icon-main').textContent = getWeatherIconEmoji(weather.weather[0].main);
                
                // Details
                document.getElementById('feels-like').textContent = `${Math.round(weather.main.feels_like)}Â°`;
                document.getElementById('humidity').textContent = `${weather.main.humidity}%`;
                document.getElementById('wind-speed').textContent = `${weather.wind.speed} ${windUnit}`;

                // Forecast
                const forecastGrid = document.getElementById('forecast-grid');
                forecastGrid.innerHTML = '';
                const dailyForecasts = forecast.list.filter(item => item.dt_txt.includes("12:00:00")).slice(0, 5);
                
                dailyForecasts.forEach(day => {
                    const dayCard = document.createElement('div');
                    dayCard.className = 'flex justify-between items-center p-2 rounded-lg hover:bg-slate-100';
                    const dayName = new Date(day.dt * 1000).toLocaleDateString('en-US', { weekday: 'long' });
                    const temp = `${Math.round(day.main.temp_max)}Â° / ${Math.round(day.main.temp_min)}Â°`;
                    const icon = getWeatherIconEmoji(day.weather[0].main);

                    dayCard.innerHTML = `
                        <p class="font-semibold text-slate-600 w-1/3">${dayName}</p>
                        <div class="text-2xl w-1/3 text-center">${icon}</div>
                        <p class="text-sm text-slate-500 w-1/3 text-right">${temp}</p>
                    `;
                    forecastGrid.appendChild(dayCard);
                });
            }

            searchForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const city = cityInput.value.trim();
                if (city) fetchWeatherData(city);
            });

            unitToggle.addEventListener('change', () => {
                currentUnit = unitToggle.checked ? 'imperial' : 'metric';
                fetchWeatherData(lastCity);
            });
            
            fetchWeatherData(lastCity);
        });
    </script>
</body>
</html>
